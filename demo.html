<html>

<head>
    <title>Adventurous Parser Demo</title>
    <script type="text/javascript" src="adventurousparser.js"></script>
</head>

<body>
    <div id="output"></div>
    <form id="input-form">
        <input placeholder="Command" id="input-field" style="width:80%;padding:.5em" autocomplete="off">
    </form>

    <script>
        let form = document.getElementById("input-form");
        let field = document.getElementById("input-field");

        form.onsubmit = function (e) {
            e.preventDefault();
            parse(field.value);
            field.value = null;
        };

        let log = function(value) {
            output.innerHTML += '<div style="margin-bottom:.5em">&gt; ' + field.value + '</div>';
            output.innerHTML += '<div style="margin-bottom:.5em">' + value + '</div>';
        }

        let commands = {
            help: function() {
                log("Mögliche Kommandos: nimm, geh(e), untersuche, betrachte, schau(e)")
            },
            go: function(target) {
                log("GO TO " + target);
            },
            take: function(item, giver) {
                if (giver) {
                    log("TAKE " + item + " FROM " + giver);
                } else {
                    log("TAKE " + item);
                }
            },
            examine: function(item) {
                log("EXAMINE " + item);
            },
            unknown: function() {
                log("Das habe ich nicht verstanden. Gib 'hilfe' für verfügbare Kommandos ein.");
            }
        }

        let commandParsers = [
            [
                "hilfe",
                function(params) { commands.help() }
            ],
            [
                "nimm [den|die|das] :item (aus|von|vom) [der|dem] :giver",
                function(params) { commands.take(params.item, params.giver) }
            ],
            [
                "nimm [den|die|das] :item",
                function(params) { commands.take(params.item) }
            ],
            [
                "geh[e] [nach|in|zu|zum|zur] [dem|den|der|die|das] :target",
                function(params) { commands.go(params.target) }
            ],
            [
                "(betrachte|schau[e]|untersuche) [den|die|das] :item",
                function(params) { commands.examine(params.item) }
            ],
            [
                ":else",
                function(params) { commands.unknown(params.input)}
            ]
        ]

        let parse = function(input) {
            for (let commandParser of commandParsers) {
                let parser = new AdventurousParser(commandParser[0]);
                let command = commandParser[1];
                let parserResult = parser.match(input);
                if (parserResult.matching) {
                    command(parserResult.params);
                    break;
                }
            };
        }
    </script>
</body>

</html>